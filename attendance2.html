<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8">
  <title>الغياب والحضور – SchoolMate</title>
  <style>
    body {
      margin:0;
      font-family: Tahoma, Arial, sans-serif;
      background:#C8BBBE;
      color:#333;
    }
    header {
      text-align:center;
      background:#5D4037;
      color:#fff;
      padding:10px 0;
    }
    header h1 { margin:0; font-size:24px; }
    .tagline {
      text-align:center;
      background:#5D4037;
      color:#fff;
      padding:6px;
      font-size:14px;
      margin:0;
    }
    #navbar {
      background:#8D6E63;
      padding:8px;
      display:flex;
      align-items:center;
      gap:15px;
    }
    #navbar label { color:#fff; font-size:14px; }
    #navbar select { padding:4px 6px; border-radius:4px; }
    #navbar ul {
      list-style:none;
      margin:0;
      padding:0;
      display:flex;
      flex:1;
      justify-content:center;
    }
    #navbar > ul > li { position:relative; margin:0 10px; }
    #navbar > ul > li > a {
      color:white;
      text-decoration:none;
      padding:6px 8px;
      display:inline-block;
      cursor:pointer;
      font-size:15px;
    }
    .submenu {
      display:none !important;
      position:absolute;
      top:32px; right:0;
      background:#fff;
      padding:5px;
      border-radius:6px;
      box-shadow:0 3px 8px rgba(0,0,0,0.15);
      min-width:140px;
      z-index:100;
    }
    .submenu li { margin:4px 0; }
    .submenu a {
      color:#333;
      text-decoration:none;
      display:block;
      padding:6px 8px;
      font-size:14px;
      border-radius:4px;
    }
    .submenu a:hover { background:#eee; }
    .submenu.open { display:block !important; }
    table th, table td { text-align:center; }
    button { cursor:pointer; margin:2px; }
  </style>
</head>
<body>

  <header>
    <h1>SchoolMate - كشكولك الرقمي</h1>
  </header>
  <p class="tagline">كشكولك الرقمي لمتابعة الغياب، تسجيل الواجبات، والتقارير اليومية</p>

  <div id="navbar">
    <label for="roleSelect">اختر الدور:</label>
    <select id="roleSelect">
      <option value="student">طالب</option>
      <option value="teacher">معلم</option>
    </select>

    <ul id="studentMenu">
      <li>
        <a href="#" class="top-link">الغياب والحضور</a>
        <ul class="submenu">
          <li><a href="student attendance1.html">الصف الأول الثانوي</a></li>
          <li><a href="student attendance2.html">الصف الثاني الثانوي</a></li>
        </ul>
      </li>
      <li>
        <a href="#" class="top-link">الدرجات</a>
        <ul class="submenu">
          <li><a href="student grades1.html">الصف الأول الثانوي</a></li>
          <li><a href="student grades2.html">الصف الثاني الثانوي</a></li>
        </ul>
      </li>
      <li>
        <a href="#" class="top-link">التواصل</a>
        <ul class="submenu">
          <li><a href="student chat1.html">الصف الأول الثانوي</a></li>
          <li><a href="student chat2.html">الصف الثاني الثانوي</a></li>
        </ul>
      </li>
    </ul>

    <ul id="teacherMenu" style="display:none;">
      <li>
        <a href="#" class="top-link">الغياب والحضور</a>
        <ul class="submenu">
          <li><a href="attendance1.html">الصف الأول الثانوي</a></li>
          <li><a href="attendance2.html">الصف الثاني الثانوي</a></li>
        </ul>
      </li>
      <li>
        <a href="#" class="top-link">الدرجات</a>
        <ul class="submenu">
          <li><a href="grades1.html">الصف الأول الثانوي</a></li>
          <li><a href="grades2.html">الصف الثاني الثانوي</a></li>
        </ul>
      </li>
      <li>
        <a href="#" class="top-link">التواصل</a>
        <ul class="submenu">
          <li><a href="chat1.html">الصف الأول الثانوي</a></li>
          <li><a href="chat2.html">الصف الثاني الثانوي</a></li>
        </ul>
      </li>
    </ul>
  </div>

  <h1 align="center">الغياب والحضور</h1>
  <p align="center">سجل حضور الطلاب يوميًا بسهولة</p>
  <hr color="white" size="3">

  <div align="center">
    <button onclick="clearData()"> حذف جميع البيانات</button>
  </div>
  <br>

  <table border="1" width="90%" align="center" cellpadding="3" bgcolor="#DEB887" id="attendanceTable">
    <tr>
      <th>الاسم</th>
    </tr>
    <tr><td>جنى</td></tr>
    <tr><td>سيف</td></tr>
    <tr><td>احمد</td></tr>
    <tr><td>سارة</td></tr>
  </table>

  <br>
  <p style="cursor:pointer; color:blue;" onclick="window.location.href='index.html'"> الرجوع للصفحة الرئيسية</p>

  <script>
    document.addEventListener('DOMContentLoaded', function () {
      const roleSelect = document.getElementById('roleSelect');
      const studentMenu = document.getElementById('studentMenu');
      const teacherMenu = document.getElementById('teacherMenu');

      const savedRole = localStorage.getItem('selectedRole');
      if (savedRole) {
        roleSelect.value = savedRole;
        if (savedRole === 'student') {
          studentMenu.style.display = 'flex';
          teacherMenu.style.display = 'none';
        } else {
          studentMenu.style.display = 'none';
          teacherMenu.style.display = 'flex';
        }
      }

      roleSelect.addEventListener('change', () => {
        if (roleSelect.value === 'student') {
          studentMenu.style.display = 'flex';
          teacherMenu.style.display = 'none';
        } else {
          studentMenu.style.display = 'none';
          teacherMenu.style.display = 'flex';
        }
        localStorage.setItem('selectedRole', roleSelect.value);
      });

      const topLinks = document.querySelectorAll('#navbar .top-link');
      topLinks.forEach(link => {
        link.addEventListener('click', (e) => {
          e.preventDefault();
          const submenu = link.nextElementSibling;
          document.querySelectorAll('.submenu').forEach(sm => {
            if (sm !== submenu) sm.classList.remove('open');
          });
          submenu.classList.toggle('open');
        });
      });
      document.addEventListener('click', function(e) {
        if (!e.target.closest('#navbar')) {
          document.querySelectorAll('.submenu').forEach(sm => sm.classList.remove('open'));
        }
      });
    });
  </script>

  <script type="module">
    import { initializeApp, getApps } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
    import { getDatabase, ref, set, remove } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBoqPEnCjtYPbWI9yYXg9eBdrPk5KvSHOg",
      authDomain: "schoolmate-d49cd.firebaseapp.com",
      databaseURL: "https://schoolmate-d49cd-default-rtdb.firebaseio.com",
      projectId: "schoolmate-d49cd",
      storageBucket: "schoolmate-d49cd.firebasestorage.app",
      messagingSenderId: "394386208739",
      appId: "1:394386208739:web:211725ccb837298cab92d6",
      measurementId: "G-64K767NCG3"
    };

    const app = getApps().length ? getApps()[0] : initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const days = ["الأحد","الإثنين","الثلاثاء","الأربعاء","الخميس","الجمعة","السبت"];

    window.addEventListener("load", () => {
      const table = document.getElementById("attendanceTable");
      const startDate = new Date(2025, 9, 12); 
      const totalDays = 14;
      const headerRow = table.rows[0];

      for (let i = 0; i < totalDays; i++) {
        const date = new Date(startDate);
        date.setDate(startDate.getDate() + i);
        const th = document.createElement("th");
        th.innerText = days[date.getDay()] + " " + date.toLocaleDateString("ar-EG");
        th.bgColor = "#C58917";
        th.style.fontSize = "12px";
        headerRow.appendChild(th);
      }

      for (let r = 1; r < table.rows.length; r++) {
        const studentName = table.rows[r].cells[0].innerText.trim();
        for (let c = 0; c < totalDays; c++) {
          const cell = document.createElement("td");
          const date = new Date(startDate);
          date.setDate(startDate.getDate() + c);
          const dayIndex = date.getDay();
          if (dayIndex === 5 || dayIndex === 6) {
            cell.innerText = "إجازة";
            cell.bgColor = "#EBDDE2";
            cell.style.fontSize = "10px";
          } else {
            addAttendanceButtons(cell, studentName, c);
            const saved = localStorage.getItem(`${studentName}_${c}`);
            if (saved === "حضور" || saved === "غياب") {
              updateCell(cell, saved, studentName, c);
            }
          }
          table.rows[r].appendChild(cell);
        }
      }

      function addAttendanceButtons(cell, student, day) {
        cell.innerHTML = "";
        cell.style.backgroundColor = "";
        const presentBtn = document.createElement("button");
        presentBtn.innerText = "✔";
        presentBtn.onclick = () => markAttendance(student, day, "حضور", cell);
        const absentBtn = document.createElement("button");
        absentBtn.innerText = "✘";
        absentBtn.onclick = () => markAttendance(student, day, "غياب", cell);
        cell.appendChild(presentBtn);
        cell.appendChild(absentBtn);
      }

      function updateCell(cell, status, student, day) {
        cell.style.backgroundColor = (status === "حضور") ? "#4CAF50" : "#F44336";
        const label = (status === "حضور") ? "✔ حضور" : "✘ غياب";
        const editBtnHTML =
          ` <button style="background-color:#E6D3C6; border:none; cursor:pointer; padding:2px 8px; border-radius:6px;"
             onclick="editAttendance('${student}', ${day}, this)">✎ تعديل</button>`;
        cell.innerHTML = label + editBtnHTML;
      }

      window.markAttendance = (student, day, status, cell) => {
        if (day > 0) {
          const prev = localStorage.getItem(`${student}_${day - 1}`);
          if (!prev) {
            const d = new Date(startDate);
            d.setDate(startDate.getDate() + day);
            alert("لا يمكنك تسجيل يوم " + days[d.getDay()] + " قبل تسجيل اليوم السابق!");
            return;
          }
        }
        updateCell(cell, status, student, day);
        localStorage.setItem(`${student}_${day}`, status);
        set(ref(db, `attendance/الصف_الثاني/${student}/${day}`), { status }).catch(console.error);
      };

      window.editAttendance = (student, day, btn) => {
        const cell = btn.parentElement;
        cell.style.backgroundColor = "#DEB887";
        addAttendanceButtons(cell, student, day);
        localStorage.removeItem(`${student}_${day}`);
      };

      window.clearData = () => {
        if (confirm("هل أنت متأكد أنك تريد حذف جميع البيانات؟")) {
          localStorage.clear();
          remove(ref(db, "attendance/الصف_الثاني"))
            .then(() => {
              alert("تم حذف جميع البيانات");
              location.reload();
            })
            .catch(console.error);
        }
      };
    });
  </script>

</body>
</html>
