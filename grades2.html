<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8">
  <title>درجات الامتحانات الشهرية – SchoolMate</title>
  <style>
    body { font-family:"Tahoma",sans-serif; background:#C8BBBE; margin:0; padding:0; }
    header.site-header { text-align:center; background:#5D4037; color:#fff; padding:10px 0; }
    header.site-header h1 { margin:0; font-size:24px; }
    .tagline { text-align:center; background:#5D4037; color:#fff; padding:6px; font-size:14px; margin:0; }
    #navbar { background:#8D6E63; padding:8px; display:flex; align-items:center; gap:15px; }
    #navbar label { color:#fff; font-size:14px; }
    #navbar select { padding:4px 6px; border-radius:4px; }
    #navbar ul { list-style:none; margin:0; padding:0; display:flex; flex:1; justify-content:center; }
    #navbar > ul > li { position:relative; margin:0 10px; }
    #navbar > ul > li > a { color:white; text-decoration:none; padding:6px 8px; display:inline-block; cursor:pointer; font-size:15px; }
    .submenu { display:none !important; position:absolute; top:32px; right:0; background:#fff; padding:5px; border-radius:6px; box-shadow:0 3px 8px rgba(0,0,0,0.15); min-width:140px; z-index:100; }
    .submenu li { margin:4px 0; }
    .submenu a { color:#333; text-decoration:none; display:block; padding:6px 8px; font-size:14px; border-radius:4px; }
    .submenu a:hover { background:#eee; }
    .submenu.open { display:block !important; }

    h1.page-title { text-align:center; margin:20px 0 5px 0; }
    p.page-subtitle { text-align:center; margin:0 0 10px 0; }

    table { width:90%; margin:auto; border-collapse:collapse; background:#DEB887; }
    table, th, td { border:1px solid #000; }
    th, td { padding:3px; text-align:center; }
    th { background:#C58917; }
    input[type=number] { width:50px; }
    button { padding:8px 12px; cursor:pointer; margin:5px; }
  </style>
</head>
<body>

  <header class="site-header">
    <h1>SchoolMate - كشكولك الرقمي</h1>
  </header>
  <p class="tagline">كشكولك الرقمي لمتابعة الغياب، تسجيل الواجبات، والتقارير اليومية</p>

  <div id="navbar">
    <label for="roleSelect">اختر الدور:</label>
    <select id="roleSelect">
      <option value="student">طالب</option>
      <option value="teacher">معلم</option>
    </select>

    <ul id="studentMenu">
      <li>
        <a href="#" class="top-link">الغياب والحضور</a>
        <ul class="submenu">
          <li><a href="student attendance1.html">الصف الأول الثانوي</a></li>
          <li><a href="student attendance2.html">الصف الثاني الثانوي</a></li>
        </ul>
      </li>
      <li>
        <a href="#" class="top-link">الدرجات</a>
        <ul class="submenu">
          <li><a href="student grades1.html">الصف الأول الثانوي</a></li>
          <li><a href="student grades2.html">الصف الثاني الثانوي</a></li>
        </ul>
      </li>
      <li>
        <a href="#" class="top-link">التواصل</a>
        <ul class="submenu">
          <li><a href="student chat1.html">الصف الأول الثانوي</a></li>
          <li><a href="student chat2.html">الصف الثاني الثانوي</a></li>
        </ul>
      </li>
    </ul>

    <ul id="teacherMenu" style="display:none;">
      <li>
        <a href="#" class="top-link">الغياب والحضور</a>
        <ul class="submenu">
          <li><a href="attendance1.html">الصف الأول الثانوي</a></li>
          <li><a href="attendance2.html">الصف الثاني الثانوي</a></li>
        </ul>
      </li>
      <li>
        <a href="#" class="top-link">الدرجات</a>
        <ul class="submenu">
          <li><a href="grades1.html">الصف الأول الثانوي</a></li>
          <li><a href="grades2.html">الصف الثاني الثانوي</a></li>
        </ul>
      </li>
      <li>
        <a href="#" class="top-link">التواصل</a>
        <ul class="submenu">
          <li><a href="chat1.html">الصف الأول الثانوي</a></li>
          <li><a href="chat2.html">الصف الثاني الثانوي</a></li>
        </ul>
      </li>
    </ul>
  </div>

  <h1 class="page-title">درجات الامتحانات الشهرية</h1>
  <p class="page-subtitle">سجل درجات الطلاب بسهولة</p>
  <hr color="white" size="3">
  
  <p style="text-align:right; font-weight:bold;">الدرجة النهائية لكل مادة: 20</p>

  <div style="text-align:center;">
    <button onclick="clearData()">حذف جميع البيانات</button>
  </div>
  <br>

  <table id="gradesTable">
    <tr>
      <th>الاسم</th>
    </tr>
    <tr><td>جنى</td></tr>
    <tr><td>سيف</td></tr>
    <tr><td>احمد</td></tr>
    <tr><td>سارة</td></tr>
  </table>

  <br>
  <p style="cursor:pointer; color:blue;" onclick="window.location.href='index.html'">الرجوع للصفحة الرئيسية</p>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getDatabase, ref, set, get, child, remove } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBoqPEnCjtYPbWI9yYXg9eBdrPk5KvSHOg",
      authDomain: "schoolmate-d49cd.firebaseapp.com",
      databaseURL: "https://schoolmate-d49cd-default-rtdb.firebaseio.com",
      projectId: "schoolmate-d49cd",
      storageBucket: "schoolmate-d49cd.firebasestorage.app",
      messagingSenderId: "394386208739",
      appId: "1:394386208739:web:211725ccb837298cab92d6",
      measurementId: "G-64K767NCG3"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    const subjects = ["عربي","إنجليزي","ماث","ساينس","تاريخ","فلسفة"];
    const months = ["أكتوبر","نوفمبر","ديسمبر"];
    const table = document.getElementById("gradesTable");
    const maxGrade = 20;
    const className = "الصف الثاني الثانوي";

    for (let m=0;m<months.length;m++){
      for (let s=0;s<subjects.length;s++){
        let th=document.createElement("th");
        th.innerText=subjects[s]+" ("+months[m]+")";
        table.rows[0].appendChild(th);
      }
    }

    for(let r=1;r<table.rows.length;r++){
      let studentName=table.rows[r].cells[0].innerText;
      for(let m=0;m<months.length;m++){
        for(let s=0;s<subjects.length;s++){
          let cell=document.createElement("td");
          let input=document.createElement("input");
          input.type="number"; input.min=0; input.max=maxGrade; input.style.width="50px";

          input.oninput=function(){ if(input.value>maxGrade){ alert("الدرجة لا يمكن أن تتجاوز "+maxGrade); input.value=""; } };
          input.onchange=function(){ set(ref(db,"grades/"+className+"/"+studentName+"/"+months[m]+"/"+subjects[s]), input.value); };
          get(child(ref(db),"grades/"+className+"/"+studentName+"/"+months[m]+"/"+subjects[s]))
            .then(snap=>{ if(snap.exists()) input.value=snap.val(); });

          cell.appendChild(input); table.rows[r].appendChild(cell);
        }
      }
    }

    window.clearData=function(){ 
      if(confirm("هل انت متأكد انك تريد حذف جميع البيانات")){ 
        remove(ref(db,"grades/"+className)).then(()=>{ 
          alert("تم حذف جميع البيانات"); location.reload(); 
        }); 
      } 
    }

    const roleSelect = document.getElementById('roleSelect');
    const studentMenu = document.getElementById('studentMenu');
    const teacherMenu = document.getElementById('teacherMenu');
    const savedRole = localStorage.getItem('selectedRole');
    if(savedRole){ 
      roleSelect.value=savedRole; 
      if(savedRole==='student'){ studentMenu.style.display='flex'; teacherMenu.style.display='none'; } 
      else{ studentMenu.style.display='none'; teacherMenu.style.display='flex'; } 
    }
    roleSelect.addEventListener('change',()=>{
      const role=roleSelect.value; 
      localStorage.setItem('selectedRole',role); 
      if(role==='student'){ studentMenu.style.display='flex'; teacherMenu.style.display='none'; } 
      else{ studentMenu.style.display='none'; teacherMenu.style.display='flex'; } 
    });

    document.querySelectorAll('#navbar .top-link').forEach(link=>{
      link.addEventListener('click', e=>{
        e.preventDefault();
        const submenu=link.nextElementSibling;
        document.querySelectorAll('.submenu').forEach(sm=>{ if(sm!==submenu) sm.classList.remove('open'); });
        submenu.classList.toggle('open');
      });
    });
    document.addEventListener('click',e=>{ if(!e.target.closest('#navbar')) document.querySelectorAll('.submenu').forEach(sm=>sm.classList.remove('open')); });
  </script>
</body>
</html>
