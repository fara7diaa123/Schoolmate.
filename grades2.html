<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8">
  <title>درجات الامتحانات الشهرية– SchoolMate</title>
</head>
<body bgcolor="#C8BBBE">
  <h1 align="center">درجات الامتحانات الشهرية</h1>
  <p align="center">سجل درجات الطلاب بسهولة</p>
  <hr color="white" size="3">
  
  <p style="text-align:right; color:rgb(0, 0, 0); font-weight:bold;">الدرجة النهائية لكل مادة: 20</p>

  <div align="center">
    <button onclick="clearData()"> حذف جميع البيانات</button>
  </div>
  <br>

  <table border="1" width="90%" align="center" cellpadding="3" bgcolor="#DEB887" id="gradesTable">
    <tr bgcolor="#C58917">
      <th>الاسم</th>
    </tr>

    <tr><td>جنى</td></tr>
    <tr><td>سيف</td></tr>
    <tr><td>احمد</td></tr>
    <tr><td>سارة</td></tr>
  </table>

  <br>
  <p style="cursor:pointer; color:blue;" onclick="window.location.href='index.html'"> الرجوع للصفحة الرئيسية</p>

  <script type="module">
    // ---------------- Firebase ----------------
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getDatabase, ref, set, get, child, remove } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBoqPEnCjtYPbWI9yYXg9eBdrPk5KvSHOg",
      authDomain: "schoolmate-d49cd.firebaseapp.com",
      databaseURL: "https://schoolmate-d49cd-default-rtdb.firebaseio.com",
      projectId: "schoolmate-d49cd",
      storageBucket: "schoolmate-d49cd.firebasestorage.app",
      messagingSenderId: "394386208739",
      appId: "1:394386208739:web:211725ccb837298cab92d6",
      measurementId: "G-64K767NCG3"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    // ---------------- إعداد الجدول ----------------
    const subjects = ["عربي","إنجليزي","ماث","ساينس","تاريخ","فلسفة"];
    const months = ["أكتوبر","نوفمبر","ديسمبر"];
    const table = document.getElementById("gradesTable");
    const maxGrade = 20;

    // اسم الصف الحالي
    const className = "الصف الثاني الثانوي"; // <<< هنا اتغير بس

    // إضافة عناوين المواد والشهور
    for (let m = 0; m < months.length; m++) {
      for (let s = 0; s < subjects.length; s++) {
        let header = document.createElement("th");
        header.innerText = subjects[s] + " (" + months[m] + ")";
        table.rows[0].appendChild(header);
      }
    }

    // إضافة خانات الدرجات
    for (let r = 1; r < table.rows.length; r++) {
      let studentName = table.rows[r].cells[0].innerText;
      for (let m = 0; m < months.length; m++) {
        for (let s = 0; s < subjects.length; s++) {
          let cell = document.createElement("td");
          let input = document.createElement("input");
          input.type = "number";
          input.min = 0;
          input.max = maxGrade;
          input.style.width = "50px";

          // لما يكتب المدرس الدرجة
          input.oninput = function () {
            if (input.value > maxGrade) {
              alert("الدرجة لا يمكن أن تتجاوز " + maxGrade);
              input.value = "";
            }
          };

          // حفظ الدرجة في Firebase (داخل الصف الحالي)
          input.onchange = function () {
            set(ref(db, "grades/" + className + "/" + studentName + "/" + months[m] + "/" + subjects[s]), input.value);
          };

          // استرجاع الدرجات من Firebase عند تحميل الصفحة
          get(child(ref(db), "grades/" + className + "/" + studentName + "/" + months[m] + "/" + subjects[s]))
            .then((snapshot) => {
              if (snapshot.exists()) {
                input.value = snapshot.val();
              }
            });

          cell.appendChild(input);
          table.rows[r].appendChild(cell);
        }
      }
    }

    // ---------------- مسح بيانات الصف الحالي فقط ----------------
    window.clearData = function () {
      if (confirm("هل انت متاكد انك تريد حذف جميع البيانات ")) {
        remove(ref(db, "grades/" + className)).then(() => {
          alert("تم حذف جميع البيانات " );
          location.reload();
        });
      }
    }
  </script>
</body>
</html>
