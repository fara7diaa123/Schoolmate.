<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8">
  <title>ØºÙŠØ§Ø¨ÙŠ â€“ SchoolMate</title>
</head>
<body bgcolor="#C8BBBE">
  <h1 align="center">Ø§Ù„ØºÙŠØ§Ø¨ ÙˆØ§Ù„Ø­Ø¶ÙˆØ±</h1>
  <p align="center">Ø§Ø®ØªØ± Ø§Ø³Ù…Ùƒ Ù„Ø¹Ø±Ø¶ Ø³Ø¬Ù„ Ø§Ù„ØºÙŠØ§Ø¨ Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ</p>
  <hr color="white" size="3">

  <div align="center">
    <label for="studentSelect"><b>Ø§Ø®ØªØ± Ø§Ø³Ù…Ùƒ:</b></label>
    <select id="studentSelect">
      <option value="">-- Ø§Ø®ØªØ± --</option>
      <option value="Ø¬Ù†Ù‰">Ø¬Ù†Ù‰</option>
      <option value="Ø³ÙŠÙ">Ø³ÙŠÙ</option>
      <option value="Ø§Ø­Ù…Ø¯">Ø£Ø­Ù…Ø¯</option>
      <option value="Ø³Ø§Ø±Ø©">Ø³Ø§Ø±Ø©</option>
    </select>
    <button onclick="showAttendance()">Ø§Ø¹Ø±Ø¶ ØºÙŠØ§Ø¨ÙŠ</button>
  </div>

  <br>
  <table border="1" width="70%" align="center" cellpadding="6" bgcolor="#DEB887" id="attendanceTable" style="display:none; text-align:center; border-collapse:collapse; font-size:14px;">
    <thead>
      <tr bgcolor="#C58917" id="headerRow">
        <th>Ø§Ù„ÙŠÙˆÙ…</th>
        <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
        <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <p id="noDataMsg" style="text-align:center; color:rgb(150, 12, 12); display:none; font-weight:bold;"></p>

  <br>
  <p style="cursor:pointer; color:blue;" onclick="window.location.href='index.html'">Ø§Ù„Ø±Ø¬ÙˆØ¹ Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</p>

  <!-- Ø§Ù„Ø¬Ø§ÙØ§Ø³ÙƒØ±ÙŠØ¨Øª -->
  <script type="module">
    import { initializeApp, getApps } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
    import { getDatabase, ref, get } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-database.js";

    // ğŸ”‘ Ø¨ÙŠØ§Ù†Ø§Øª Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyBoqPEnCjtYPbWI9yYXg9eBdrPk5KvSHOg",
      authDomain: "schoolmate-d49cd.firebaseapp.com",
      databaseURL: "https://schoolmate-d49cd-default-rtdb.firebaseio.com",
      projectId: "schoolmate-d49cd",
      storageBucket: "schoolmate-d49cd.firebasestorage.app",
      messagingSenderId: "394386208739",
      appId: "1:394386208739:web:211725ccb837298cab92d6",
      measurementId: "G-64K767NCG3"
    };

    const app = getApps().length ? getApps()[0] : initializeApp(firebaseConfig);
    const db = getDatabase(app);

    const days = ["Ø§Ù„Ø£Ø­Ø¯","Ø§Ù„Ø¥Ø«Ù†ÙŠÙ†","Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡","Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡","Ø§Ù„Ø®Ù…ÙŠØ³","Ø§Ù„Ø¬Ù…Ø¹Ø©","Ø§Ù„Ø³Ø¨Øª"];
    const startDate = new Date(2025, 9, 12); // 9 = Ø£ÙƒØªÙˆØ¨Ø±
    const totalDays = 14;

    window.showAttendance = async function () {
      const studentName = document.getElementById("studentSelect").value;
      const table = document.getElementById("attendanceTable");
      const tbody = table.querySelector("tbody");
      const noDataMsg = document.getElementById("noDataMsg");

      if (!studentName) {
        alert("Ù…Ù† ÙØ¶Ù„Ùƒ Ø§Ø®ØªØ± Ø§Ø³Ù…Ùƒ");
        return;
      }

      tbody.innerHTML = "";
      noDataMsg.style.display = "none";

      let foundData = false;

      for (let i = 0; i < totalDays; i++) {
        const date = new Date(startDate);
        date.setDate(startDate.getDate() + i);
        const dayName = days[date.getDay()];
        const formattedDate = date.toLocaleDateString("ar-EG");

        if (date.getDay() === 5 || date.getDay() === 6) {
          // Ø§Ù„Ø¬Ù…Ø¹Ø© ÙˆØ§Ù„Ø³Ø¨Øª Ø¥Ø¬Ø§Ø²Ø©
          let tr = document.createElement("tr");
          tr.innerHTML = `<td>${dayName}</td><td>${formattedDate}</td><td style="background-color:#EBDDE2;">Ø¥Ø¬Ø§Ø²Ø©</td>`;
          tbody.appendChild(tr);
          continue;
        }

        // ğŸ” Ù‚Ø±Ø§Ø¡Ø© Ù…Ù† Firebase ØªØ­Øª Ù…Ø³Ø§Ø± "Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù†ÙŠ"
        const snapshot = await get(ref(db, `attendance/Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù†ÙŠ/${studentName}/${i}`));
        let status = snapshot.exists() ? snapshot.val().status : null;

        let tr = document.createElement("tr");
        if (status) {
          foundData = true;
          tr.innerHTML = `<td>${dayName}</td><td>${formattedDate}</td>
            <td style="background-color:${status === "Ø­Ø¶ÙˆØ±" ? "#4CAF50" : "#F44336"}; color:white;">
              ${status}
            </td>`;
        } else {
          tr.innerHTML = `<td>${dayName}</td><td>${formattedDate}</td><td>Ù„Ù… ÙŠØªÙ… Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø¨Ø¹Ø¯</td>`;
        }
        tbody.appendChild(tr);
      }

      table.style.display = "table";
      if (!foundData) {
        noDataMsg.innerText = "Ù„Ù… ÙŠØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø£ÙŠ Ø¨ÙŠØ§Ù†Ø§Øª Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†";
        noDataMsg.style.display = "block";
      }
    }
  </script>
</body>
</html>
