<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8">
  <title>درجاتي – SchoolMate</title>
</head>
<body bgcolor="#C8BBBE">
  <h1 align="center">درجات الامتحانات الشهرية</h1>
  <p align="center">اختر اسمك لعرض درجاتك الشهرية</p>
  <hr color="white" size="3">
  <p style="text-align:right; color:rgb(0, 0, 0); font-weight:bold;">الدرجة النهائية لكل مادة: 20</p>
  
  <div align="center">
    <label for="studentSelect"><b>اختر اسمك:</b></label>
    <select id="studentSelect">
      <option value="">-- اختر --</option>
      <option value="جنى">جنى</option>
      <option value="سيف">سيف</option>
      <option value="احمد">احمد</option>
      <option value="سارة">سارة</option>
    </select>
    <button onclick="showGrades()">اعرض درجاتي</button>
  </div>

  <br>
  <table border="1" width="70%" align="center" cellpadding="6" bgcolor="#DEB887" id="gradesTable" style="display:none; text-align:center; border-collapse:collapse; font-size:16px;">
    <thead>
      <tr bgcolor="#C58917">
        <th>المادة</th>
        <th>الشهر</th>
        <th>الدرجة</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <p id="noGradesMsg" style="text-align:center; color:rgb(150, 12, 12); display:none; font-weight:bold;"></p>

  <br>
  <p style="cursor:pointer; color:blue;" onclick="window.location.href='index.html'"> الرجوع للصفحة الرئيسية</p>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getDatabase, ref, get } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBoqPEnCjtYPbWI9yYXg9eBdrPk5KvSHOg",
      authDomain: "schoolmate-d49cd.firebaseapp.com",
      databaseURL: "https://schoolmate-d49cd-default-rtdb.firebaseio.com",
      projectId: "schoolmate-d49cd",
      storageBucket: "schoolmate-d49cd.firebasestorage.app",
      messagingSenderId: "394386208739",
      appId: "1:394386208739:web:211725ccb837298cab92d6",
      measurementId: "G-64K767NCG3"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    const subjects = ["عربي","إنجليزي","ماث","ساينس","تاريخ","فلسفة"];
    const months = ["أكتوبر","نوفمبر","ديسمبر"];
    const className = "الصف الثاني الثانوي";

    window.showGrades = async function () {
      const studentName = document.getElementById("studentSelect").value;
      const table = document.getElementById("gradesTable");
      const tbody = table.querySelector("tbody");
      const noGradesMsg = document.getElementById("noGradesMsg");

      if (!studentName) {
        alert("من فضلك اختر اسمك");
        return;
      }

      tbody.innerHTML = ""; 
      noGradesMsg.style.display = "none"; 

      let foundGrades = false;

      for (let m of months) {
        for (let s of subjects) {
          let gradeRef = ref(db, "grades/" + className + "/" + studentName + "/" + m + "/" + s);
          let snapshot = await get(gradeRef);
          if (snapshot.exists()) {
            foundGrades = true;
            let tr = document.createElement("tr");
            tr.innerHTML = `<td>${s}</td><td>${m}</td><td>${snapshot.val()}</td>`;
            tbody.appendChild(tr);
          }
        }
      }

      if (foundGrades) {
        table.style.display = "table";
      } else {
        table.style.display = "none";
        noGradesMsg.innerText = "لم يتم إدخال الدرجات بعد";
        noGradesMsg.style.display = "block";
      }
    }
  </script>
</body>
</html>

