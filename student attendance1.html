<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8">
  <title>غيابي – SchoolMate</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      margin:0;
      font-family: Tahoma, Arial, sans-serif;
      background:#C8BBBE;
      color:#333;
    }
    header {
      text-align:center;
      background:#5D4037;
      color:#fff;
      padding:10px 0;
    }
    header h1 { margin:0; font-size:24px; }
    .tagline {
      text-align:center;
      background:#5D4037;
      color:#fff;
      padding:6px;
      font-size:14px;
      margin:0;
    }
    #navbar {
      background:#8D6E63;
      padding:8px;
      display:flex;
      align-items:center;
      gap:15px;
      flex-wrap:wrap;
      justify-content:center;
    }
    #navbar label { color:#fff; font-size:14px; }
    #navbar select { padding:4px 6px; border-radius:4px; }
    #navbar ul { list-style:none; margin:0; padding:0; display:flex; flex:1; justify-content:center; }
    #navbar > ul > li { position:relative; margin:0 10px; }
    #navbar > ul > li > a { color:white; text-decoration:none; padding:6px 8px; display:inline-block; cursor:pointer; font-size:15px; }
    .submenu {
      display:none !important;
      position:absolute;
      top:32px; right:0;
      background:#fff;
      padding:5px;
      border-radius:6px;
      box-shadow:0 3px 8px rgba(0,0,0,0.15);
      min-width:140px;
      z-index:100;
    }
    .submenu li { margin:4px 0; }
    .submenu a {
      color:#333;
      text-decoration:none;
      display:block;
      padding:6px 8px;
      font-size:14px;
      border-radius:4px;
    }
    .submenu a:hover { background:#eee; }
    .submenu.open { display:block !important; }
  </style>
</head>
<body bgcolor="#C8BBBE">

  <header>
    <h1>SchoolMate - كشكولك الرقمي</h1>
  </header>
  <p class="tagline">كشكولك الرقمي لمتابعة الغياب، تسجيل الواجبات، والتقارير اليومية</p>

  <div id="navbar">
    <label for="roleSelect">اختر الدور:</label>
    <select id="roleSelect">
      <option value="student">طالب</option>
      <option value="teacher">معلم</option>
    </select>

    <ul id="studentMenu">
      <li>
        <a href="#" class="top-link">الغياب والحضور</a>
        <ul class="submenu">
          <li><a href="student attendance1.html">الصف الأول الثانوي</a></li>
          <li><a href="student attendance2.html">الصف الثاني الثانوي</a></li>
        </ul>
      </li>
      <li>
        <a href="#" class="top-link">الدرجات</a>
        <ul class="submenu">
          <li><a href="student grades1.html">الصف الأول الثانوي</a></li>
          <li><a href="student grades2.html">الصف الثاني الثانوي</a></li>
        </ul>
      </li>
      <li>
        <a href="#" class="top-link">التواصل</a>
        <ul class="submenu">
          <li><a href="student chat1.html">الصف الأول الثانوي</a></li>
          <li><a href="student chat2.html">الصف الثاني الثانوي</a></li>
        </ul>
      </li>
    </ul>

    <ul id="teacherMenu" style="display:none;">
      <li>
        <a href="#" class="top-link">الغياب والحضور</a>
        <ul class="submenu">
          <li><a href="attendance1.html">الصف الأول الثانوي</a></li>
          <li><a href="attendance2.html">الصف الثاني الثانوي</a></li>
        </ul>
      </li>
      <li>
        <a href="#" class="top-link">الدرجات</a>
        <ul class="submenu">
          <li><a href="grades1.html">الصف الأول الثانوي</a></li>
          <li><a href="grades2.html">الصف الثاني الثانوي</a></li>
        </ul>
      </li>
      <li>
        <a href="#" class="top-link">التواصل</a>
        <ul class="submenu">
          <li><a href="chat1.html">الصف الأول الثانوي</a></li>
          <li><a href="chat2.html">الصف الثاني الثانوي</a></li>
        </ul>
      </li>
    </ul>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', function () {
      const topLinks = document.querySelectorAll('#navbar .top-link');
      const roleSelect = document.getElementById('roleSelect');
      const studentMenu = document.getElementById('studentMenu');
      const teacherMenu = document.getElementById('teacherMenu');

      const savedRole = localStorage.getItem('role');
      if (savedRole) {
        roleSelect.value = savedRole;
        if (savedRole === 'student') {
          studentMenu.style.display = 'flex';
          teacherMenu.style.display = 'none';
        } else {
          studentMenu.style.display = 'none';
          teacherMenu.style.display = 'flex';
        }
      }

      roleSelect.addEventListener('change', () => {
        const selectedRole = roleSelect.value;
        localStorage.setItem('role', selectedRole); 
        if (selectedRole === 'student') {
          studentMenu.style.display = 'flex';
          teacherMenu.style.display = 'none';
        } else {
          studentMenu.style.display = 'none';
          teacherMenu.style.display = 'flex';
        }
      });

      function setupSubmenu(links) {
        links.forEach(link => {
          link.addEventListener('click', (e) => {
            e.preventDefault();
            const submenu = link.nextElementSibling;
            document.querySelectorAll('.submenu').forEach(sm => {
              if (sm !== submenu) sm.classList.remove('open');
            });
            submenu.classList.toggle('open');
          });
        });
      }

      setupSubmenu(topLinks);

      document.addEventListener('click', function(e) {
        if (!e.target.closest('#navbar')) {
          document.querySelectorAll('.submenu').forEach(sm => sm.classList.remove('open'));
        }
      });
    });
  </script>

  <h1 align="center">الغياب والحضور</h1>
  <p align="center">اختر اسمك لعرض سجل الغياب الخاص بك</p>
  <hr color="white" size="3">

  <div align="center">
    <label for="studentSelect"><b>اختر اسمك:</b></label>
    <select id="studentSelect">
      <option value="">-- اختر --</option>
      <option value="عمار">عمار</option>
      <option value="غزل">غزل</option>
      <option value="سالمين">سالمين</option>
      <option value="محمد">محمد</option>
    </select>
    <button onclick="showAttendance()">اعرض غيابي</button>
  </div>

  <br>
  <table border="1" width="70%" align="center" cellpadding="6" bgcolor="#DEB887" id="attendanceTable" style="display:none; text-align:center; border-collapse:collapse; font-size:14px;">
    <thead>
      <tr bgcolor="#C58917" id="headerRow">
        <th>اليوم</th>
        <th>التاريخ</th>
        <th>الحالة</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <p id="noDataMsg" style="text-align:center; color:rgb(150, 12, 12); display:none; font-weight:bold;"></p>

  <br>
  <p style="cursor:pointer; color:blue;" onclick="window.location.href='index.html'">الرجوع للصفحة الرئيسية</p>

  <script type="module">
    import { initializeApp, getApps } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
    import { getDatabase, ref, get } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBoqPEnCjtYPbWI9yYXg9eBdrPk5KvSHOg",
      authDomain: "schoolmate-d49cd.firebaseapp.com",
      databaseURL: "https://schoolmate-d49cd-default-rtdb.firebaseio.com",
      projectId: "schoolmate-d49cd",
      storageBucket: "schoolmate-d49cd.firebasestorage.app",
      messagingSenderId: "394386208739",
      appId: "1:394386208739:web:211725ccb837298cab92d6",
      measurementId: "G-64K767NCG3"
    };

    const app = getApps().length ? getApps()[0] : initializeApp(firebaseConfig);
    const db = getDatabase(app);

    const days = ["الأحد","الإثنين","الثلاثاء","الأربعاء","الخميس","الجمعة","السبت"];
    const startDate = new Date(2025, 9, 12); 
    const totalDays = 14;

    window.showAttendance = async function () {
      const studentName = document.getElementById("studentSelect").value;
      const table = document.getElementById("attendanceTable");
      const tbody = table.querySelector("tbody");
      const noDataMsg = document.getElementById("noDataMsg");

      if (!studentName) {
        alert("من فضلك اختر اسمك");
        return;
      }

      tbody.innerHTML = "";
      noDataMsg.style.display = "none";

      let foundData = false;

      for (let i = 0; i < totalDays; i++) {
        const date = new Date(startDate);
        date.setDate(startDate.getDate() + i);
        const dayName = days[date.getDay()];
        const formattedDate = date.toLocaleDateString("ar-EG");

        if (date.getDay() === 5 || date.getDay() === 6) {
          let tr = document.createElement("tr");
          tr.innerHTML = `<td>${dayName}</td><td>${formattedDate}</td><td style="background-color:#EBDDE2;">إجازة</td>`;
          tbody.appendChild(tr);
          continue;
        }

        const snapshot = await get(ref(db, `attendance/الصف_الأول/${studentName}/${i}`));
        let status = snapshot.exists() ? snapshot.val().status : null;

        let tr = document.createElement("tr");
        if (status) {
          foundData = true;
          tr.innerHTML = `<td>${dayName}</td><td>${formattedDate}</td>
            <td style="background-color:${status === "حضور" ? "#4CAF50" : "#F44336"}; color:white;">
              ${status}
            </td>`;
        } else {
          tr.innerHTML = `<td>${dayName}</td><td>${formattedDate}</td><td>لم يتم التسجيل بعد</td>`;
        }
        tbody.appendChild(tr);
      }

      table.style.display = "table";
      if (!foundData) {
        noDataMsg.innerText = "لم يتم تسجيل أي بيانات حتى الآن";
        noDataMsg.style.display = "block";
      }
    }
  </script>
</body>
</html>
